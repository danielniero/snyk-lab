# This config was automatically generated from your source code
# Stacks detected: cicd:github-actions:.github/workflows,deps:node:.,test:jest:
version: 2.1
orbs:
  node: circleci/node@5
jobs:
  snyk-os:
    executor: node/default
    context: TEMP
    steps:
      - checkout
      - node/install-packages:
          cache-path: ~/project/node_modules
          override-ci-command: npm install
      - run:
          command: |
            wget -O snyk https://static.snyk.io/cli/latest/snyk-linux
            chmod +x ./snyk
            mv ./snyk /usr/local/bin/
      - run:
          command: |
            snyk auth
            snyk test --org=c26f7459-bcd7-472c-be67-fb38dd91af5a
            snyk monitor --org=c26f7459-bcd7-472c-be67-fb38dd91af5a

    snyk-code:
      machine:
        image: ubuntu-2204:current
      context: TEMP
      steps:
        - checkout
        - run:
            command: |
              wget -O snyk https://static.snyk.io/cli/latest/snyk-linux
              chmod +x ./snyk
              mv ./snyk /usr/local/bin/
        - run:
            command: |
              snyk auth
              snyk code test --org=c26f7459-bcd7-472c-be67-fb38dd91af5a

    snyk-iac:
      machine:
        image: ubuntu-2204:current
      context: TEMP
      steps:
        - checkout
        - run:
            command: |
              wget -O snyk https://static.snyk.io/cli/latest/snyk-linux
              chmod +x ./snyk
              mv ./snyk /usr/local/bin/
        - run:
            command: |
              snyk auth
              snyk iac test --org=c26f7459-bcd7-472c-be67-fb38dd91af5a --report

    snyk-container:
      docker:
      - image: cimg/base:2022.09
      context: TEMP
      steps:
        - checkout
        - run:
            command: |
              docker build -t test:latest .
        - run:
            command: |
              wget -O snyk https://static.snyk.io/cli/latest/snyk-linux
              chmod +x ./snyk
              mv ./snyk /usr/local/bin/
        - run:
            command: |
              snyk auth
              snyk container test test:latest --org=c26f7459-bcd7-472c-be67-fb38dd91af5a --file=Dockerfile
              snyk container monitor test:latest --org=c26f7459-bcd7-472c-be67-fb38dd91af5a --file=Dockerfile
workflows:
  build-and-test:
    jobs:
      - snyk-os
      - snyk-code
      - snyk-iac
      - snyk-container